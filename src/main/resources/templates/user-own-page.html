<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title th:text="${user.getUsername()}">'s page</title>
    <link rel="stylesheet" type="text/css" media="all" href="../static/css/main.css" th:href="@{/css/main.css}"/>
    <link rel="stylesheet" type="text/css" media="all" href="../static/css/animatedObjects.css" th:href="@{/css/animatedObjects.css}"/>
    <link rel="stylesheet" type="text/css" media="all" href="../static/css/page.css" th:href="@{/css/page.css}"/>
    <script th:src="@{/js/deleteRows.js}"></script>
</head>
<body>
<div class="moon-wrapper">
    <div class="moon"></div>
</div>
<div class="stars">
</div>
<div class="cloud cloud1"></div>
<div class="cloud cloud2"></div>
<div class="page-wrapper">
    <div th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
        <h2>Admin panel</h2>
    </div>
    <div th:if="${!#authorization.expression('hasRole(''ADMIN'')')}">
        <h2>
            <span th:text="${user.getUsername()}"></span>'s dreams
        </h2>
    </div>
    <div th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
        <div class="dream-card">
            <a class="list-admin" th:href="@{/dreams}">Dreams <i style="font-size: 0.75rem"> series of thoughts, images,
                and sensations occurring in a person's mind during sleep</i></a><br>
            <a class="list-admin" th:href="@{/users}">Users <i style="font-size: 0.75rem">people who dream</i></a><br>
            <a class="list-admin" th:href="@{/interpretations}">Interpretations <i style="font-size: 0.75rem">the actions of explaining the meaning of dreams</i></a><br>
            <a class="list-admin" th:href="@{/symbols}">Symbols <i style="font-size: 0.75rem">marks or characters used as conventional representations of dreams</i></a>
        </div>
    </div>
    <div th:if="${!#authorization.expression('hasRole(''ADMIN'')')}">
        <a class="btn" style="transform: rotate(5deg); left: 32rem; margin-top: -2rem;" th:href="@{/dreams/add}">Share a new dream</a>
        <div class="search-bar">
            <label for="dreamSearch"></label><input type="text" id="dreamSearch" placeholder="Search dreams...">
        </div>
        <div th:if="${#lists.isEmpty(user.dreams)}">
            <p>You have shared no dreams for now!</p>
        </div>
        <div th:each="dream : ${user.dreams}" class="dream-card">
            <h4 th:text="${dream.title}">Dream Title</h4>
            <h5 class="truncate" th:text="${dream.description}">Dream description...</h5>
            <a class="btn" th:href="@{/full-info-dream/{id}(id=${dream.id})}">Open</a>
            <a class="btn" th:href="@{/dreams/edit/{id}(id=${dream.id})}">Rewrite</a>
            <button class="btn" onclick="deleteDream(this)" th:name="${dream.getId()}">Delete</button>
        </div>
    </div>
</div>

<script>
    const searchInput = document.getElementById('dreamSearch');
    const dreamCards = document.querySelectorAll('.dream-card');

    searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase();

        dreamCards.forEach(card => {
            const title = card.querySelector('h4, h3')?.textContent.toLowerCase() || '';
            const description = card.querySelector('h5, p')?.textContent.toLowerCase() || '';

            if (title.includes(query) || description.includes(query)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
</script>
</body>
</html>
